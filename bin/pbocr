#!/usr/bin/env bash

set -e

readonly scriptname="${0##*/}"


function usage() {
  cat <<USAGE >&2
Usage: $scriptname

Run OCR on the content of clipboard and send text to STDOUT.

Required packages: wl-clipboard (for Wayland), xclip (for X), tesseract

USAGE
  exit "${1:-1}"
}


function error() {
  >&2 echo "$scriptname: $1"
  >&2 echo "Try '$scriptname -h' for more information."
  exit "${2:-1}"
}


function main_x() {
  # For X:
  xclip -selection clipboard -t image/png -l 1 -o \
    | tesseract stdin stdout
}


function main() {
  # For Wayland:
  wl-paste -t image/png | tesseract stdin stdout
}


if [ "$0" = "${BASH_SOURCE[0]}" ]; then
  while getopts "h" opt; do
    case $opt in
      h|\?)
        if [ "$opt" = "h" ]; then usage 0; else usage; fi
        ;;
    esac
  done
  shift $((OPTIND - 1))

  main "$@"
fi
